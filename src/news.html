<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Portal de Notícias</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        body {
            background-color: #f5f5f5;
            color: #333;
            line-height: 1.6;
        }

        .header {
            background-color: #a52a2a;
            color: white;
            padding: 15px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .logo {
            font-size: 24px;
            font-weight: bold;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .header-buttons {
            display: flex;
            gap: 15px;
        }

        .header-buttons button {
            background-color: white;
            color: #a52a2a;
            padding: 8px 16px;
            border: none;
            cursor: pointer;
            font-weight: bold;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .header-buttons button:hover {
            background-color: #f0f0f0;
        }

        .top-nav {
            background-color: #fff;
            border-bottom: 1px solid #ddd;
            padding: 10px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            position: sticky;
            top: 70px;
            z-index: 999;
        }

        .top-nav ul {
            display: flex;
            justify-content: center;
            gap: 20px;
            list-style: none;
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }

        .top-nav li a {
            text-decoration: none;
            color: #a52a2a;
            font-weight: bold;
            font-size: 16px;
            padding: 8px 12px;
            border-radius: 5px;
            transition: all 0.3s;
            cursor: pointer;
        }

        .top-nav li a:hover {
            background-color: #ffe5e5;
        }

        .top-nav li a.active {
            background-color: #a52a2a;
            color: white;
        }

        .container {
            max-width: 1200px;
            margin: 20px auto;
            padding: 0 20px;
        }

        .news-section {
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.05);
            overflow: hidden;
            margin-bottom: 30px;
        }

        .section-header {
            background-color: #a52a2a;
            color: white;
            padding: 12px 20px;
            font-size: 18px;
            font-weight: bold;
        }

        .news-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            padding: 20px;
        }

        .news-item {
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            animation: fadeInUp 0.5s ease forwards;
            opacity: 0;
            position: relative;
        }

        .news-item:hover {
            transform: translateY(-5px);
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .news-item img {
            width: 100%;
            height: 180px;
            object-fit: cover;
        }

        .news-content {
            padding: 15px;
        }

        .news-tag {
            background-color: #f0f0f0;
            color: #a52a2a;
            padding: 4px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: bold;
            display: inline-block;
            margin-bottom: 10px;
        }

        .news-title {
            color: #333;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .news-description {
            font-size: 14px;
            color: #666;
            margin-bottom: 15px;
        }

        .news-meta {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #888;
        }

        .delete-button {
            background-color: #a52a2a;
            color: white;
            border: none;
            padding: 5px 10px;
            cursor: pointer;
            font-size: 13px;
            border-radius: 5px;
            transition: background 0.3s;
            position: absolute;
            top: 10px;
            right: 10px;
        }

        .delete-button:hover {
            background-color: #8b2323;
        }

        .publish-button {
            background-color: #a52a2a;
            color: white;
            padding: 12px 20px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            border-radius: 30px;
            margin-bottom: 20px;
            transition: background-color 0.3s ease;
            display: none;
        }

        .publish-button:hover {
            background-color: #8b2323;
        }

        #searchContainer {
            margin: 0 auto 20px auto;
            display: flex;
            justify-content: center;
        }

        #searchInput {
            width: 100%;
            max-width: 500px;
            padding: 12px 20px;
            font-size: 16px;
            border-radius: 30px;
            border: 1px solid #ddd;
            outline: none;
            transition: all 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        #searchInput:focus {
            border-color: #a52a2a;
            box-shadow: 0 2px 8px rgba(165, 42, 42, 0.1);
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-content {
            background: white;
            padding: 25px;
            border-radius: 12px;
            width: 400px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.15);
        }

        .modal-content h2 {
            color: #a52a2a;
            margin-bottom: 15px;
            font-size: 20px;
            text-align: center;
        }

        .modal-content input, .modal-content textarea {
            width: 100%;
            padding: 10px;
            margin-bottom: 12px;
            border: 1px solid #ccc;
            border-radius: 8px;
            font-size: 14px;
        }

        .modal-content textarea {
            height: 100px;
            resize: vertical;
        }

        .modal-buttons {
            display: flex;
            justify-content: space-between;
            gap: 10px;
            margin-top: 15px;
        }

        .modal-buttons button {
            flex: 1;
            padding: 10px;
            font-size: 14px;
            border-radius: 6px;
            cursor: pointer;
        }

        .modal-buttons .publish-button {
            background-color: #a52a2a;
            color: white;
            border: none;
        }

        .modal-buttons .cancel-button {
            background-color: #f0f0f0;
            color: #333;
            border: 1px solid #ddd;
        }

        .footer {
            background-color: #333;
            color: #fff;
            padding: 30px 0;
            text-align: center;
            margin-top: 40px;
        }

        .footer p {
            margin-bottom: 10px;
        }

        .footer a {
            color: #a52a2a;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                gap: 15px;
                padding: 15px;
            }
            
            .top-nav ul {
                justify-content: flex-start;
                overflow-x: auto;
                padding-bottom: 5px;
                -webkit-overflow-scrolling: touch;
            }
            
            .news-grid {
                grid-template-columns: 1fr;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
</head>
<body>
    <div class="header">
        <div class="logo">
            <i class="fas fa-newspaper"></i>
            <span>Portal de Notícias</span>
        </div>
        <div class="header-buttons">
            <button onclick="location.href='chat.html'"><i class="fas fa-comments"></i> Chat</button>
            <button onclick="logout()"><i class="fas fa-sign-out-alt"></i> Sair</button>
        </div>
    </div>

    <nav class="top-nav">
        <ul>
            <li><a href="#" class="active" onclick="voltarInicio()"><i class="fas fa-home"></i> Início</a></li>
            <li><a href="#" onclick="mostrarContato()"><i class="fas fa-envelope"></i> Contato</a></li>
            <li><a href="#" onclick="mostrarSaibaMais()"><i class="fas fa-info-circle"></i> Saiba Mais</a></li>
        </ul>
    </nav>

    <div class="container">
        <button id="openModalButton" class="publish-button">Publicar Notícia</button>
        
        <div id="searchContainer">
            <input type="text" id="searchInput" placeholder="Pesquisar notícias..." />
        </div>

        <div class="news-section" id="publicacao">
            <div class="section-header">Últimas Notícias</div>
            <div class="news-grid" id="newsContainer">
                <!-- Notícias serão carregadas aqui via JavaScript -->
            </div>
        </div>
    </div>

    <div id="contato" style="display: none;">
        <div class="news-section">
            <div class="section-header">Contato</div>
            <div style="padding: 20px;">
                <h3 style="color: #a52a2a; margin-bottom: 15px;">Entre em contato conosco</h3>
                <p style="margin-bottom: 15px;">Para sugestões, dúvidas ou reportar problemas:</p>
                <p><i class="fas fa-envelope"></i> Email: <a href="mailto:vini05lu@gmail.com">vini05lu@gmail.com</a></p>
                <p><i class="fas fa-phone"></i> Telefone: (11) 97284-8599</p>
            </div>
        </div>
    </div>

    <div id="saibaMais" style="display: none;">
        <div class="news-section">
            <div class="section-header">Sobre Nós</div>
            <div style="padding: 20px;">
                <h3 style="color: #a52a2a; margin-bottom: 15px;">Portal de Notícias</h3>
                <p style="margin-bottom: 15px;">Nosso portal oferece as últimas notícias com curadoria especial e conteúdo atualizado diariamente.</p>
                <p>Nossa missão é trazer informações relevantes e de qualidade para nossos leitores, com imparcialidade e precisão.</p>
            </div>
        </div>
    </div>

    <div class="modal" id="publishModal">
        <div class="modal-content">
            <h2><i class="fas fa-plus-circle"></i> Publicar Notícia</h2>
            <input type="text" id="newsTitle" placeholder="Título da notícia" />
            <textarea id="newsCaption" placeholder="Descrição da notícia"></textarea>
            <input type="text" id="newsImage" placeholder="URL da imagem" />
            <div class="modal-buttons">
                <button class="publish-button" onclick="publishNews()"><i class="fas fa-paper-plane"></i> Publicar</button>
                <button class="cancel-button" onclick="closeModal()"><i class="fas fa-times"></i> Fechar</button>
            </div>
        </div>
    </div>

    <div class="footer">
        <p>© 2023 Portal de Notícias - Todos os direitos reservados</p>
        <p>Desenvolvido por <a href="#">Vinícius</a></p>
    </div>

    <script>
        window.logout = function() {
            sessionStorage.removeItem("loggedInUser");
            window.location.href = "./news.html";
        };

        let allNews = []; // para guardar todas as notícias carregadas

        document.addEventListener("DOMContentLoaded", () => {
            const user = JSON.parse(sessionStorage.getItem("loggedInUser"));
            if (!user) {
                window.location.href = "./index.html";
                return;
            }

            if (user.role === "admin") {
                document.getElementById("openModalButton").style.display = "block";
            }

            loadNews();
            setInterval(updateLikes, 5000);

            document.getElementById('searchInput').addEventListener('input', (e) => {
                filterNews(e.target.value);
            });
        });

        function updateLikes() {
            fetch("/curtidas")
                .then(res => res.json())
                .then(curtidas => {
                    Object.keys(curtidas).forEach(id => {
                        const span = document.getElementById(`likes_${id}_count`);
                        if (span) {
                            span.textContent = `${curtidas[id]} curtidas`;
                        }
                    });
                });
        }

        function loadNews() {
            Promise.all([
                fetch("/images").then(res => res.json()),
                fetch("/curtidas").then(res => res.json())
            ]).then(([images, curtidas]) => {
                allNews = images; // guardo todas as notícias

                renderNews(images, curtidas);
            });
        }

        function renderNews(images, curtidas) {
            const newsContainer = document.getElementById("newsContainer");
            newsContainer.innerHTML = '';

            images.forEach((image, index) => {
                const newsItem = document.createElement("div");
                newsItem.classList.add("news-item");
                newsItem.style.animationDelay = `${index * 0.1}s`;
                newsItem.style.opacity = '1';

                const formattedCaption = formatText(image.caption || "Descrição da notícia.");
                const likes = curtidas[image.id] || 0;

                newsItem.innerHTML = `
                    ${image.url ? `<img src="${image.url}" alt="Imagem da notícia">` : '<div style="height: 180px; background-color: #eee; display: flex; align-items: center; justify-content: center; color: #888;">Sem imagem</div>'}
                    <div class="news-content">
                        <span class="news-tag">Geral</span>
                        <h3 class="news-title">${image.title || "Título da Notícia"}</h3>
                        <p class="news-description">${formattedCaption}</p>
                        <div class="news-meta">
                            <span><i class="far fa-thumbs-up"></i> <span id="likes_${image.id}_count">${likes} curtidas</span></span>
                            <span><i class="far fa-clock"></i> Hoje</span>
                        </div>
                    </div>
                    ${isAdmin() ? `<button class="delete-button" onclick="deleteImage('${image.id}')"><i class="fas fa-trash"></i> Excluir</button>` : ""}
                `;

                newsContainer.appendChild(newsItem);
            });
        }

        function filterNews(searchTerm) {
            searchTerm = searchTerm.toLowerCase();

            fetch("/curtidas")
                .then(res => res.json())
                .then(curtidas => {
                    const filtered = allNews.filter(news =>
                        (news.title || "").toLowerCase().includes(searchTerm) ||
                        (news.caption || "").toLowerCase().includes(searchTerm)
                    );
                    renderNews(filtered, curtidas);
                });
        }

        function publishNews() {
            const user = JSON.parse(sessionStorage.getItem("loggedInUser"));
            if (!user || user.role !== "admin") {
                alert("Apenas administradores podem publicar notícias!");
                return;
            }

            const title = document.getElementById('newsTitle').value;
            const caption = document.getElementById('newsCaption').value;
            const imageUrl = document.getElementById('newsImage').value;

            if (!title || !caption) {
                alert("Título e descrição são obrigatórios!");
                return;
            }

            fetch('/save-image', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({ title, caption, url: imageUrl })
            }).then(() => {
                closeModal();
                loadNews();
                document.getElementById('newsTitle').value = '';
                document.getElementById('newsCaption').value = '';
                document.getElementById('newsImage').value = '';
                document.getElementById('searchInput').value = '';
            });
        }

        function formatText(text) {
            return text.replace(/(https?:\/\/[^\s]+)/g, (url) => {
                return `<a href="${url}" target="_blank">${url}</a>`;
            });
        }

        window.deleteImage = function(id) {
            if (!confirm("Tem certeza que deseja excluir esta notícia?")) return;

            fetch(`/delete-image/${id}`, { method: 'DELETE' })
                .then(response => {
                    if (response.ok) {
                        loadNews();
                    } else {
                        alert("Erro ao excluir a notícia!");
                    }
                })
                .catch(error => console.error("Erro ao excluir:", error));
        };

        function isAdmin() {
            const user = JSON.parse(sessionStorage.getItem("loggedInUser"));
            return user && user.role === "admin";
        }

        function closeModal() {
            document.getElementById("publishModal").style.display = "none";
        }

        document.getElementById("openModalButton").addEventListener("click", () => {
            if (isAdmin()) {
                document.getElementById("publishModal").style.display = "flex";
            } else {
                alert("Apenas administradores podem publicar notícias!");
            }
        });

        function mostrarContato() {
            document.getElementById("contato").style.display = "block";
            document.getElementById("publicacao").style.display = "none";
            document.getElementById("saibaMais").style.display = "none";
            document.querySelector('.top-nav a.active').classList.remove('active');
            event.target.classList.add('active');
        }

        function mostrarSaibaMais() {
            document.getElementById("saibaMais").style.display = "block";
            document.getElementById("publicacao").style.display = "none";
            document.getElementById("contato").style.display = "none";
            document.querySelector('.top-nav a.active').classList.remove('active');
            event.target.classList.add('active');
        }

        function voltarInicio() {
            document.getElementById("publicacao").style.display = "block";
            document.getElementById("contato").style.display = "none";
            document.getElementById("saibaMais").style.display = "none";
            document.querySelector('.top-nav a.active').classList.remove('active');
            event.target.classList.add('active');
        }
    </script>
</body>
</html>
